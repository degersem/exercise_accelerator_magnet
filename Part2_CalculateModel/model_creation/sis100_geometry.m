% Construction of the SIS100 geometry
% to be completed within FEMM

% A. Geometry point
point=[
  0 0;
  25 0;
  82.5 0;
  165 0;
  165 124.5-52;
  165-52 124.5;
  0 124.5;
  0 33;
  0 25;
  82.5 33+2;
  82.5-9.64 33+2;
  82.5-12.64 33;
  82.5-1.5 40.5-1.5;
  82.5-1.5 40.5+1.5;
  82.5-19.64+1.5 40.5-1.5;
  82.5-19.64+1.5 40.5+1.5;
  82.5-6.14+3 4.17+0*8.18;
  82.5-6.14-3 4.17+0*8.18;
  82.5-6.14-8.36+3 4.17+0*8.18;
  82.5-6.14-8.36-3 4.17+0*8.18;
  82.5-6.14+3 4.17+1*8.18;
  82.5-6.14-3 4.17+1*8.18;
  82.5-6.14-8.36+3 4.17+1*8.18;
  82.5-6.14-8.36-3 4.17+1*8.18;
  82.5-6.14+3 4.17+2*8.18;
  82.5-6.14-3 4.17+2*8.18;
  82.5-6.14-8.36+3 4.17+2*8.18;
  82.5-6.14-8.36-3 4.17+2*8.18;
  82.5-6.14+3 4.17+3*8.18;
  82.5-6.14-3 4.17+3*8.18;
  82.5-6.14-8.36+3 4.17+3*8.18;
  82.5-6.14-8.36-3 4.17+3*8.18;
  82.5-6.14+2.5 4.17+0*8.18;
  82.5-6.14-2.5 4.17+0*8.18;
  82.5-6.14-8.36+2.5 4.17+0*8.18;
  82.5-6.14-8.36-2.5 4.17+0*8.18;
  82.5-6.14+2.5 4.17+1*8.18;
  82.5-6.14-2.5 4.17+1*8.18;
  82.5-6.14-8.36+2.5 4.17+1*8.18;
  82.5-6.14-8.36-2.5 4.17+1*8.18;
  82.5-6.14+2.5 4.17+2*8.18;
  82.5-6.14-2.5 4.17+2*8.18;
  82.5-6.14-8.36+2.5 4.17+2*8.18;
  82.5-6.14-8.36-2.5 4.17+2*8.18;
  82.5-6.14+2.5 4.17+3*8.18;
  82.5-6.14-2.5 4.17+3*8.18;
  82.5-6.14-8.36+2.5 4.17+3*8.18;
  82.5-6.14-8.36-2.5 4.17+3*8.18;
  ];
figure(1); clf; plot_point(point);

% B. Geometry line segments
line_segment=[
  1 2;
  2 3;
  3 4;
  4 5;
  5 6;
  6 7;
  7 8;
  8 9;
  9 1;
  3 10;
  10 11;
  11 12;
  12 8;
  14 16;
  13 15
  ];
%figure(1); hold on; plot_line_segment(line_segment);

% C. Geometry arc segments
arc_segment=[
  2 9 90;
  13 14 180;
  16 15 180;
  17 18 180;
  18 17 180;
  19 20 180;
  20 19 180;
  21 22 180;
  22 21 180;
  23 24 180;
  24 23 180;
  25 26 180;
  26 25 180;
  27 28 180;
  28 27 180;
  29 30 180;
  30 29 180;
  31 32 180;
  32 31 180;
  16+17 16+18 180;
  16+18 16+17 180;
  16+19 16+20 180;
  16+20 16+19 180;
  16+21 16+22 180;
  16+22 16+21 180;
  16+23 16+24 180;
  16+24 16+23 180;
  16+25 16+26 180;
  16+26 16+25 180;
  16+27 16+28 180;
  16+28 16+27 180;
  16+29 16+30 180;
  16+30 16+29 180;
  16+31 16+32 180;
  16+32 16+31 180;
  ];
%figure(1); hold on; plot_arc_segment(arc_segment);

% D. Regions
rg=0;
rg=rg+1; region(rg)=struct('x',82.5/2,'y',(33+124.5)/2,'label','FE');              % iron yoke
rg=rg+1; region(rg)=struct('x',25/2/sqrt(2),'y',25/2/sqrt(2),'label','A');         % aperture inside the reference circle
rg=rg+1; region(rg)=struct('x',25,'y',25,'label','A');                             % aperture outside the reference circle
rg=rg+1; region(rg)=struct('x',82.5-19.64/2,'y',40.5,'label','A');                 % air inclusion
for p=0:3                                                                          % coils
  rg=rg+1; region(rg)=struct('x',82.5-6.14,'y',4.17+p*8.18,'label','A');
  rg=rg+1; region(rg)=struct('x',82.5-6.14+(2.5+3)/2,'y',4.17+p*8.18,'label','C');
  rg=rg+1; region(rg)=struct('x',82.5-6.14-8.36,'y',4.17+p*8.18,'label','A');
  rg=rg+1; region(rg)=struct('x',82.5-6.14-8.36+(2.5+3)/2,'y',4.17+p*8.18,'label','C');
end  

% E. Write to .fem file
prb.Depth=3000;                   % [mm]    : depth of the model
prb.LengthUnits='millimeters';
%write_femm_geometry(1,prb,point,line_segment,arc_segment,region);
fout=fopen('sis_v2.fem','w');
if fout~=-1
  write_femm_geometry(fout,prb,point,line_segment,arc_segment,region);
  fclose(fout);
end
